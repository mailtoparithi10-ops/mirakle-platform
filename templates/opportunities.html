<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Alchemy – Opportunities</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Explore live innovation opportunities – cohorts, challenges, pilots and corporate programs on Alchemy.">
    <link rel="icon"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNiIgZmlsbD0iI2ZmZGYwMCIvPgo8dGV4dCB4PSI1IiB5PSIyMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSJibGFjayIgZm9udC13ZWlnaHQ9ImJvbGQiPkE8L3RleHQ+Cjwvc3ZnPg==">
    <link rel="stylesheet" href="/static/css/index.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/css/floating-elements.css">

    <style>
        /* Page layout */
        main {
            position: relative;
            z-index: 1;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 1.5rem 4rem;
        }

        /* Hero / intro */
        .opportunities-hero {
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }

        .hero-header {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        #opportunitiesHeroTitle {
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(1.8rem, 3vw, 2.4rem);
            font-weight: 900;
            letter-spacing: -1px;
            text-transform: uppercase;
        }

        #opportunitiesHeroTitle span {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #opportunitiesHeroSubtitle {
            max-width: 640px;
            font-size: 0.98rem;
            color: var(--text-secondary);
        }

        #opportunitiesStatsText {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Filters bar */
        .opportunities-filters {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filters-card {
            border-radius: 16px;
            background: rgba(255, 248, 225, 0.7);
            border: 1px solid rgba(252, 184, 46, 0.25);
            padding: 1rem 1.25rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.03);
            backdrop-filter: blur(12px);
        }

        #opportunitiesFilterForm {
            display: grid;
            grid-template-columns: minmax(0, 2fr) repeat(4, minmax(0, 1fr)) auto;
            gap: 0.75rem;
            align-items: center;
        }

        .filter-field {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .filter-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }

        .filter-input,
        .filter-select {
            width: 100%;
            border-radius: 999px;
            border: 1px solid var(--border-secondary);
            padding: 6px 10px;
            font-size: 0.85rem;
            outline: none;
            background: #fff;
        }

        .filter-input:focus,
        .filter-select:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(252, 184, 46, 0.2);
        }

        .filter-toggle {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.78rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .filter-toggle input {
            accent-color: var(--accent-primary);
        }

        /* List / grid */
        .opportunities-list {
            margin-top: 1.5rem;
        }

        #opportunitiesEmptyState {
            border-radius: 12px;
            padding: 1rem 1.25rem;
            border: 1px dashed var(--border-secondary);
            background: var(--bg-secondary);
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.25rem;
        }

        .opportunity-card {
            border-radius: 16px;
            padding: 1.25rem;
            background: #ffffff;
            border: 1px solid var(--border-primary);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 190px;
            transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
        }

        .opportunity-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 14px 32px rgba(0, 0, 0, 0.08);
            border-color: rgba(252, 184, 46, 0.6);
        }

        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .opportunity-title {
            font-size: 1rem;
            font-weight: 700;
        }

        .opportunity-badge {
            font-size: 0.68rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border-radius: 999px;
            padding: 4px 8px;
            border: 1px solid transparent;
            white-space: nowrap;
        }

        .status-open {
            border-color: rgba(46, 204, 113, 0.4);
            background: rgba(46, 204, 113, 0.08);
            color: #12753c;
        }

        .status-closing_soon {
            border-color: rgba(252, 184, 46, 0.6);
            background: rgba(252, 184, 46, 0.12);
            color: #8a5a00;
        }

        .status-in_progress {
            border-color: rgba(52, 152, 219, 0.5);
            background: rgba(52, 152, 219, 0.08);
            color: #145a86;
        }

        .status-completed {
            border-color: rgba(108, 117, 125, 0.4);
            background: rgba(108, 117, 125, 0.08);
            color: #495057;
        }

        .status-closed {
            border-color: rgba(220, 53, 69, 0.4);
            background: rgba(220, 53, 69, 0.08);
            color: #842029;
        }

        .opportunity-host {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.35rem;
        }

        .opportunity-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .opportunity-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            margin-bottom: 0.75rem;
        }

        .chip {
            font-size: 0.72rem;
            border-radius: 999px;
            padding: 3px 8px;
            border: 1px solid var(--border-secondary);
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .opportunity-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            margin-top: auto;
        }

        .opportunity-reward {
            font-size: 0.85rem;
            font-weight: 600;
            color: #0f5132;
        }

        .opportunity-reward span {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
        }

        .btn-secondary {
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid var(--border-secondary);
            background: #ffffff;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-secondary:hover {
            border-color: var(--accent-primary);
        }

        /* Pagination */
        #opportunitiesPagination {
            margin-top: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .pagination-info {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .pagination-controls {
            display: flex;
            gap: 0.5rem;
        }

        .pagination-btn {
            border-radius: 999px;
            padding: 4px 10px;
            font-size: 0.8rem;
            border: 1px solid var(--border-secondary);
            background: #ffffff;
            cursor: pointer;
        }

        .pagination-btn[disabled] {
            opacity: 0.4;
            cursor: default;
        }

        /* Responsive */
        @media (max-width: 992px) {
            #opportunitiesFilterForm {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            #opportunitiesFilterForm {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .page-container {
                padding-inline: 1rem;
            }

            .opportunity-card {
                padding: 1rem;
            }
        }

        /* Opportunity Modal Styles */
        .opp-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .opp-modal-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 24px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .close-opp-modal {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .close-opp-modal:hover {
            color: black;
        }

        .opp-detail-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: black;
        }

        .opp-detail-meta {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .opp-detail-section {
            margin-bottom: 1.5rem;
        }

        .opp-section-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
            display: block;
        }

        .opp-section-content {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .opp-apply-btn {
            display: inline-block;
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            text-align: center;
            border-radius: 12px;
            font-weight: 700;
            text-decoration: none;
            margin-top: 1rem;
            transition: transform 0.2s;
        }

        .opp-apply-btn:hover {
            transform: translateY(-2px);
        }

        /* Opportunity Images */
        .opportunity-card-banner {
            width: calc(100% + 2.5rem);
            margin: -1.25rem -1.25rem 1rem -1.25rem;
            height: 160px;
            object-fit: cover;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            border-bottom: 1px solid var(--border-primary);
        }

        .modal-opp-banner {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-primary);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .opp-modal-content {
                padding: 1.5rem;
                width: 95%;
                margin: 1rem;
            }

            .opp-detail-title {
                font-size: 1.5rem;
            }

            .opp-grid {
                grid-template-columns: 1fr;
            }

            .modal-opp-banner {
                height: 180px;
            }
        }
    </style>
</head>

<body>
    <!-- Background Pattern -->
    <div class="bg-pattern"></div>

    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <a href="/" class="logo">
                <div class="logo-icon">A</div>
                <div class="logo-text">ALCH<span class="accent">EMY</span></div>
            </a>

            <nav class="nav-menu">
                <a href="/" class="nav-link">HOME</a>
                <a href="/about" class="nav-link">ABOUT</a>
                <a href="/products" class="nav-link">PRODUCTS</a>
                {% if current_user.is_authenticated %}<a href="/opportunities"
                    class="nav-link active">OPPORTUNITIES</a>{% endif %}
                <a href="/blog" class="nav-link">BLOG</a>
                <a href="/contact" class="nav-link">CONTACT</a>

            </nav>

            <div class="nav-actions" id="navActions">
                {% if current_user.is_authenticated %}
                <div class="user-dropdown">
                    <button class="user-dropdown-btn" id="userMenuBtn">
                        <div class="user-avatar">
                            {% if current_user.profile_pic %}
                            <img src="{{ current_user.profile_pic }}" alt="{{ current_user.name }}">
                            {% else %}
                            <span>{{ current_user.name[0] | upper }}</span>
                            {% endif %}
                        </div>
                        <span class="user-name-text">{{ current_user.name }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-dropdown-content" id="userMenuContent">
                        <div class="dropdown-header">
                            <span class="dropdown-role">{{ current_user.role.title() }}</span>
                        </div>
                        <a href="{% if current_user.role == 'admin' %}/admin{% elif current_user.role == 'corporate' %}/corporate{% elif current_user.role == 'enabler' %}/enabler{% else %}/startup{% endif %}"
                            class="dropdown-item">
                            <i class="fas fa-th-large"></i> Dashboard
                        </a>
                        <a href="/auth/logout" class="dropdown-item logout">
                            <i class="fas fa-sign-out-alt"></i> Log Out
                        </a>
                    </div>
                </div>
                {% else %}
                <a href="/login" class="nav-btn secondary">LOG IN</a>
                <a href="/signup" class="nav-btn primary">GET STARTED</a>
                {% endif %}
                <button class="mobile-menu-btn" aria-label="Toggle Menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="page-container">
        <section class="opportunities-hero">
            <div class="hero-header">
                <div
                    style="display: flex; justify-content: space-between; align-items: flex-start; gap: 2rem; flex-wrap: wrap;">
                    <div style="flex: 1;">
                        <h1 id="opportunitiesHeroTitle">
                            <span>Explore live opportunities</span>
                        </h1>
                        <p id="opportunitiesHeroSubtitle">
                            Discover cohorts, challenges and pilots from corporates, governments and ecosystem partners.
                            Filter by sector, region and status to find the most relevant programs.
                        </p>
                    </div>
                    {% if current_user.is_authenticated and current_user.role == 'admin' %}
                    <div class="admin-controls" style="padding-top: 1rem;">
                        <a href="/admin#programs" class="nav-btn primary"
                            style="padding: 12px 24px; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                            <i class="fas fa-plus-circle"></i>
                            MANAGE PROGRAMS
                        </a>
                    </div>
                    {% endif %}
                </div>
                <p id="opportunitiesStatsText">
                    Loading opportunities…
                </p>
            </div>
        </section>

        <!-- Filters -->
        <div class="opportunities-filters">
            <div class="filters-card">
                <form id="opportunitiesFilterForm">
                    <div class="filter-field">
                        <label class="filter-label">Search</label>
                        <input type="text" class="filter-input" id="opportunitiesSearchInput" placeholder="Keywords...">
                    </div>
                    <div class="filter-field">
                        <label class="filter-label">Type</label>
                        <select class="filter-select" id="opportunitiesTypeFilter">
                            <option value="all">All Types</option>
                            <option value="accelerator">Accelerator</option>
                            <option value="grant">Grant</option>
                            <option value="pilot">Pilot / PoC</option>
                            <option value="challenge">Challenge</option>
                            <option value="investment">Investment</option>
                        </select>
                    </div>
                    <div class="filter-field">
                        <label class="filter-label">Sector</label>
                        <select class="filter-select" id="opportunitiesSectorFilter">
                            <option value="all">All Sectors</option>
                            <option value="fintech">Fintech</option>
                            <option value="healthtech">Healthtech</option>
                            <option value="agritech">Agritech</option>
                            <option value="cleantech">Cleantech</option>
                            <option value="enterprise">Enterprise</option>
                        </select>
                    </div>
                    <div class="filter-field">
                        <label class="filter-label">Region</label>
                        <select class="filter-select" id="opportunitiesRegionFilter">
                            <option value="all">Global</option>
                            <option value="north_america">North America</option>
                            <option value="europe">Europe</option>
                            <option value="asia">Asia</option>
                            <option value="africa">Africa</option>
                            <option value="latam">LatAm</option>
                        </select>
                    </div>
                    <div class="filter-field">
                        <label class="filter-label">Status</label>
                        <select class="filter-select" id="opportunitiesStatusFilter">
                            <option value="all">All Status</option>
                            <option value="published">Open</option>
                            <option value="closing_soon">Closing Soon</option>
                        </select>
                    </div>
                    <div class="filter-toggle">
                        <input type="checkbox" id="opportunitiesRewardToggle" value="yes">
                        <label for="opportunitiesRewardToggle">With Reward</label>
                    </div>
                </form>
            </div>
        </div>

        <!-- List -->
        <div class="opportunities-list">
            <div id="opportunitiesEmptyState" style="display: none;">
                No opportunities found matching your criteria.
            </div>
            <div class="opportunities-grid" id="opportunitiesList">
                <!-- Cards injected here -->
            </div>
        </div>

        <!-- Pagination -->
        <div id="opportunitiesPagination">
            <div class="pagination-info" id="opportunitiesPaginationInfo">
                Showing 0 opportunities
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" id="opportunitiesPrevPage" disabled>Previous</button>
                <button class="pagination-btn" id="opportunitiesNextPage" disabled>Next</button>
            </div>
        </div>
        </div>
    </main>

    <!-- Opportunity Details Modal -->
    <div id="oppDetailsModal" class="opp-modal">
        <div class="opp-modal-content">
            <span class="close-opp-modal" onclick="closeOppModal()">&times;</span>
            <div id="oppModalLoader" style="text-align: center; padding: 3rem;">
                <div class="loading"></div>
            </div>
            <div id="oppModalBody" style="display: none;">
                <img id="modalOppBanner" class="modal-opp-banner" src="" alt="Program Banner" style="display: none;">
                <div class="opp-detail-header">
                    <h2 id="modalOppTitle" class="opp-detail-title">Program Title</h2>
                    <div id="modalOppMeta" class="opp-detail-meta">
                        <!-- Tags inserted here -->
                    </div>
                </div>

                <div class="opp-detail-section">
                    <span class="opp-section-label">Description</span>
                    <p id="modalOppDescription" class="opp-section-content"></p>
                </div>

                <div class="opp-detail-section">
                    <span class="opp-section-label">Eligibility</span>
                    <p id="modalOppEligibility" class="opp-section-content"></p>
                </div>

                <div class="opp-detail-section">
                    <span class="opp-section-label">Benefits</span>
                    <p id="modalOppBenefits" class="opp-section-content"></p>
                </div>

                <div class="opp-detail-section">
                    <span class="opp-section-label">Deadline</span>
                    <p id="modalOppDeadline" class="opp-section-content"></p>
                </div>

                <a href="/startup/apply" id="modalOppApplyBtn" class="opp-apply-btn">Apply Now</a>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">ALCHEMY</div>
            <p class="footer-text">
                &copy; 2026 Alchemy Platform. All rights reserved.
            </p>
        </div>
    </footer>

    <script>
        let opportunitiesCurrentPage = 1;
        let opportunitiesTotalPages = 1;
        let opportunitiesLoadingTimeout = null;
        const currentUserRole = "{{ current_user.role if current_user.is_authenticated else 'guest' }}";

        function getOpportunitiesFilters() {
            const q = document.getElementById('opportunitiesSearchInput')?.value || '';
            const type = document.getElementById('opportunitiesTypeFilter')?.value || 'all';
            const sector = document.getElementById('opportunitiesSectorFilter')?.value || 'all';
            const region = document.getElementById('opportunitiesRegionFilter')?.value || 'all';
            const status = document.getElementById('opportunitiesStatusFilter')?.value || 'all';
            const reward = document.getElementById('opportunitiesRewardToggle')?.checked ? 'yes' : 'no';

            return { q, type, sector, region, status, has_reward: reward };
        }

        function createOpportunityCard(item) {
            const card = document.createElement('div');
            card.className = 'opportunity-card';

            // Status logic
            let statusClass = 'status-open';
            let statusLabel = 'Open';
            if (item.status === 'closing_soon') {
                statusClass = 'status-closing_soon';
                statusLabel = 'Closing Soon';
            } else if (item.status === 'in_progress') {
                statusClass = 'status-in_progress';
                statusLabel = 'In Progress';
            } else if (item.status === 'completed') {
                statusClass = 'status-completed';
                statusLabel = 'Completed';
            } else if (item.status === 'closed') {
                statusClass = 'status-closed';
                statusLabel = 'Closed';
            }

            // Host line
            const hostLine = item.owner_name ? item.owner_name + (item.owner_company ? ' (' + item.owner_company + ')' : '') : 'Alchemy Partner';

            // Chips
            let chips = [];
            if (item.type) chips.push(item.type);
            if (item.sectors && item.sectors.length) chips.push(...item.sectors.slice(0, 2));
            if (item.target_stages && item.target_stages.length) chips.push(...item.target_stages.slice(0, 1));

            // Deadline
            let deadlineText = '';
            if (item.deadline) {
                const d = new Date(item.deadline);
                deadlineText = 'Due ' + d.toLocaleDateString();
            }

            // Reward
            let rewardText = item.benefits ? 'Benefits available' : 'No specific reward';
            if (item.benefits && item.benefits.length < 30) {
                rewardText = item.benefits;
            }

            const enablerNote = '';

            card.innerHTML = `
                ${item.banner_url ? `<img src="${item.banner_url}" class="opportunity-card-banner" alt="${item.title}">` : ''}
                <div class="opportunity-header">
                    <h3 class="opportunity-title">${item.title || 'Untitled program'}</h3>
                    ${item.status ? `<span class="opportunity-badge ${statusClass}">${statusLabel}</span>` : ''}
                </div>
                ${hostLine ? `<p class="opportunity-host">Hosted by ${hostLine}</p>` : ''}
                ${item.description ? `<p class="opportunity-description">${item.description.substring(0, 120)}${item.description.length > 120 ? '...' : ''}</p>` : ''}
                <div class="opportunity-meta">
                    ${chips.map(tag => `<span class="chip">${tag}</span>`).join('')}
                    ${deadlineText ? `<span class="chip">${deadlineText}</span>` : ''}
                </div>
                <div class="opportunity-footer">
                    <div class="opportunity-reward">
                        ${rewardText}
                        ${enablerNote ? `<br><span>${enablerNote}</span>` : ''}
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn-secondary" type="button" onclick="openOppModal(${item.id})">
                            View
                        </button>
                        ${currentUserRole === 'admin' ? `
                        <a href="/admin#programs" class="btn-secondary" style="background: var(--accent-primary); color: white; border-color: var(--accent-primary); display: flex; align-items: center; justify-content: center; text-decoration: none;">
                            <i class="fas fa-edit"></i>
                        </a>` : ''}
                    </div>
                </div>
            `;

            return card;
        }

        async function openOppModal(id) {
            const modal = document.getElementById('oppDetailsModal');
            const loader = document.getElementById('oppModalLoader');
            const body = document.getElementById('oppModalBody');

            modal.style.display = 'flex';
            loader.style.display = 'block';
            body.style.display = 'none';

            try {
                const res = await fetch(`/api/opportunities/${id}`);
                const opp = await res.json();

                document.getElementById('modalOppTitle').textContent = opp.title || 'Untitled';
                document.getElementById('modalOppDescription').textContent = opp.description || 'No description provided.';
                document.getElementById('modalOppEligibility').textContent = opp.eligibility || 'Open to all qualified startups.';
                document.getElementById('modalOppBenefits').textContent = opp.benefits || 'Standard program benefits apply.';

                const deadline = opp.deadline ? new Date(opp.deadline).toLocaleDateString() : 'Rolling basis';
                document.getElementById('modalOppDeadline').textContent = deadline;

                // Meta tags
                const metaContainer = document.getElementById('modalOppMeta');
                metaContainer.innerHTML = '';
                if (opp.type) metaContainer.innerHTML += `<span class="chip">${opp.type}</span>`;
                if (opp.status) metaContainer.innerHTML += `<span class="opportunity-badge status-open">${opp.status.toUpperCase()}</span>`;

                // Image
                const bannerImg = document.getElementById('modalOppBanner');
                if (opp.banner_url) {
                    bannerImg.src = opp.banner_url;
                    bannerImg.style.display = 'block';
                } else {
                    bannerImg.style.display = 'none';
                }

                loader.style.display = 'none';
                body.style.display = 'block';

                // Update Apply logic
                const applyBtn = document.getElementById('modalOppApplyBtn');
                if (applyBtn) {
                    applyBtn.href = '/startup/apply?program_id=' + id;
                }

            } catch (err) {
                console.error('Error fetching opportunity:', err);
                closeOppModal();
            }
        }

        function closeOppModal() {
            document.getElementById('oppDetailsModal').style.display = 'none';
        }

        // Close on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('oppDetailsModal');
            if (event.target == modal) {
                closeOppModal();
            }
        }

        async function loadOpportunities(page = 1) {
            opportunitiesCurrentPage = page;

            const filters = getOpportunitiesFilters();
            const params = new URLSearchParams();

            if (filters.q) params.set('q', filters.q);
            if (filters.type && filters.type !== 'all') params.set('type', filters.type);
            if (filters.sector && filters.sector !== 'all') params.set('sector', filters.sector);
            if (filters.region && filters.region !== 'all') params.set('region', filters.region);
            if (filters.status && filters.status !== 'all') params.set('status', filters.status);
            if (filters.has_reward === 'yes') params.set('has_reward', 'yes');

            params.set('page', String(page));
            params.set('per_page', '12');

            const url = `/api/opportunities?${params.toString()}`;

            const statsText = document.getElementById('opportunitiesStatsText');
            if (statsText) {
                statsText.textContent = 'Loading opportunities…';
            }

            try {
                const res = await fetch(url);
                const json = await res.json();

                if (!json.success) {
                    console.warn('Opportunities API failed:', json.message);
                    if (statsText) statsText.textContent = 'Unable to load opportunities right now.';
                    return;
                }

                const data = json.data || {};
                const items = data.items || [];
                const pagination = data.pagination || { page: 1, per_page: 9, total_items: 0, total_pages: 1 };

                opportunitiesTotalPages = pagination.total_pages || 1;

                const listEl = document.getElementById('opportunitiesList');
                const emptyEl = document.getElementById('opportunitiesEmptyState');
                const pagInfoEl = document.getElementById('opportunitiesPaginationInfo');
                const prevBtn = document.getElementById('opportunitiesPrevPage');
                const nextBtn = document.getElementById('opportunitiesNextPage');

                if (listEl) listEl.innerHTML = '';

                if (!items.length) {
                    if (emptyEl) emptyEl.style.display = 'block';
                    if (pagInfoEl) pagInfoEl.textContent = 'No opportunities found.';
                } else {
                    if (emptyEl) emptyEl.style.display = 'none';

                    items.forEach(item => {
                        const card = createOpportunityCard(item);
                        listEl.appendChild(card);
                    });

                    if (pagInfoEl) {
                        pagInfoEl.textContent = `Showing ${items.length} of ${pagination.total_items || items.length} opportunities · Page ${pagination.page} of ${pagination.total_pages}`;
                    }
                }

                if (prevBtn) {
                    prevBtn.disabled = pagination.page <= 1;
                }

                if (nextBtn) {
                    nextBtn.disabled = pagination.page >= pagination.total_pages;
                }

                if (statsText) {
                    const total = pagination.total_items || items.length;
                    statsText.textContent = `${total} active opportunities found`;
                }

            } catch (err) {
                console.error('Error loading opportunities:', err);
                if (statsText) statsText.textContent = 'Unable to load opportunities right now.';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Initial load
            loadOpportunities(1);

            // Debounced search
            const searchInput = document.getElementById('opportunitiesSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    if (opportunitiesLoadingTimeout) {
                        clearTimeout(opportunitiesLoadingTimeout);
                    }
                    opportunitiesLoadingTimeout = setTimeout(() => {
                        loadOpportunities(1);
                    }, 400);
                });
            }

            const typeSelect = document.getElementById('opportunitiesTypeFilter');
            const sectorSelect = document.getElementById('opportunitiesSectorFilter');
            const regionSelect = document.getElementById('opportunitiesRegionFilter');
            const statusSelect = document.getElementById('opportunitiesStatusFilter');
            const rewardToggle = document.getElementById('opportunitiesRewardToggle');

            [typeSelect, sectorSelect, regionSelect, statusSelect, rewardToggle].forEach(el => {
                if (!el) return;
                el.addEventListener('change', () => loadOpportunities(1));
            });

            const prevBtn = document.getElementById('opportunitiesPrevPage');
            const nextBtn = document.getElementById('opportunitiesNextPage');

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (opportunitiesCurrentPage > 1) {
                        loadOpportunities(opportunitiesCurrentPage - 1);
                    }
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    if (opportunitiesCurrentPage < opportunitiesTotalPages) {
                        loadOpportunities(opportunitiesCurrentPage + 1);
                    }
                });
            }
        });
    </script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/main.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="/static/js/floating-elements.js"></script>
</body>

</html>