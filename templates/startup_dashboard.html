<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNiIgZmlsbD0iIzAwMDAwMCIvPgo8dGV4dCB4PSI1IiB5PSIyMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSIjZmZkZjAwIiBmb250LXdlaWdodD0iYm9sZCI+QTwvdGV4dD4Kjwvc3ZnPg==">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Startup Dashboard - Alchemy</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #ffdf00;
            --primary-dark: #e6c800;
            --bg-dark: #000000;
            --bg-page: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-dim: #64748b;
            --border: #e2e8f0;
            --transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        [data-theme="dark"] {
            --bg-page: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
            --border: #334155;
            --primary: #ffdf00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-page);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
        }

        /* Top Navigation */
        .top-nav {
            width: 100%;
            background: #000;
            padding: 0.75rem 2.5rem;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-size: 1.4rem;
            font-weight: 900;
            letter-spacing: -0.5px;
        }

        .nav-brand i {
            color: var(--primary);
        }

        .nav-dropdowns {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .dropdown {
            position: relative;
        }

        .dropdown-toggle {
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.7rem 1.1rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .dropdown-toggle:hover,
        .dropdown-toggle.active {
            color: var(--primary);
            background: rgba(255, 223, 0, 0.1);
            border-color: var(--primary);
        }

        /* Dropdown Menus */
        .dropdown-menu {
            position: absolute;
            top: 115%;
            left: 0;
            background: white;
            border-radius: 18px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            min-width: 240px;
            padding: 0.75rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: var(--transition);
            z-index: 1001;
        }

        .dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.8rem 1rem;
            color: var(--text-main);
            text-decoration: none;
            transition: var(--transition);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
        }

        .dropdown-item:hover {
            background: #f8fafc;
            color: #000;
        }

        .dropdown-item.active {
            background: rgba(255, 223, 0, 0.15);
            color: #000;
        }

        .dropdown-item.active i {
            color: var(--primary-dark);
        }

        .dropdown-item i {
            width: 18px;
            color: var(--text-dim);
        }

        .dropdown-item:hover i {
            color: var(--primary-dark);
        }

        .badge {
            margin-left: auto;
            background: #ef4444;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .badge.warning {
            background: var(--primary-dark);
            color: #000;
        }

        .badge.success {
            background: #10b981;
        }

        /* Profile Dropdown */
        .profile-dropdown {
            position: relative;
        }

        .profile-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 5px 15px 5px 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .profile-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: #000;
            font-size: 0.9rem;
        }

        .profile-name {
            color: white;
            font-size: 0.85rem;
            font-weight: 700;
        }

        /* Main Content */
        .main-content {
            margin-top: 74px;
            flex: 1;
            padding: 2.5rem 3.5rem;
            width: 100%;
            max-width: 1440px;
            margin-left: auto;
            margin-right: auto;
        }

        .dashboard-header {
            margin-bottom: 2.5rem;
        }

        .dashboard-title {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--text-main);
            letter-spacing: -0.5px;
            margin-bottom: 0.4rem;
        }

        .dashboard-subtitle {
            color: var(--text-dim);
            font-size: 1.05rem;
            font-weight: 500;
        }

        /* Sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards and Stats */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.75rem;
            border-radius: 22px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.06);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1.25rem;
        }

        .stat-label {
            font-size: 0.8rem;
            font-weight: 800;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--text-main);
            line-height: 1;
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .stat-icon.yellow {
            background: rgba(255, 223, 0, 0.15);
            color: var(--primary-dark);
        }

        .stat-icon.blue {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .stat-icon.green {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .stat-icon.purple {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }

        .trend {
            font-size: 0.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 4px;
            border-radius: 20px;
            padding: 4px 10px;
            width: fit-content;
            margin-top: 10px;
        }

        .trend.up {
            background: #dcfce7;
            color: #15803d;
        }

        .trend.down {
            background: #fee2e2;
            color: #b91c1c;
        }

        /* Tables */
        .content-box {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid var(--border);
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.03);
            margin-bottom: 2rem;
        }

        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.75rem;
        }

        .box-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text-main);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            font-size: 0.8rem;
            font-weight: 800;
            color: var(--text-dim);
            text-transform: uppercase;
            padding: 1rem;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-main);
        }

        .status-pill {
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
        }

        .status-pill.active {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .status-pill.pending {
            background: rgba(234, 179, 8, 0.15);
            color: #eab308;
        }

        .status-pill.rejected {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 12px;
            border: none;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
        }

        .btn-black {
            background: var(--text-main);
            color: var(--primary);
        }

        .btn-black:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-outline:hover {
            background: var(--border);
            border-color: var(--text-main);
        }

        /* Analytics Grid */
        .analytics-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        /* Achievements Badges */
        .badges-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .badge-card {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .badge-card.earned {
            border-color: var(--primary);
            background: #ffffff;
        }

        .badge-card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }

        .badge-card.earned i {
            color: var(--primary-dark);
        }

        .badge-card h4 {
            font-size: 0.95rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .badge-card p {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* Toggle Switches */
        .toggle-btn {
            width: 48px;
            height: 24px;
            background: #e2e8f0;
            border-radius: 30px;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-btn.active {
            background: var(--primary);
        }

        .toggle-dot {
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 3px;
            left: 3px;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-btn.active .toggle-dot {
            left: calc(100% - 21px);
            background: #000;
        }

        .settings-tab {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .settings-tab.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <!-- Top Nav -->
    <nav class="top-nav">
        <a href="/" class="nav-brand" style="text-decoration: none;">
            <i class="fas fa-hexagon-nodes"></i>
            ALCHEMY
        </a>

        <div class="nav-dropdowns">
            <!-- Dashboard Dropdown -->
            <div class="dropdown" id="dashboardDropdown">
                <button class="dropdown-toggle active" onclick="toggleDropdown('dashboardDropdown')">
                    <i class="fas fa-grid-2"></i> Dashboard <i class="fas fa-chevron-down"
                        style="font-size: 0.7rem;"></i>
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" onclick="showSection('overview')"><i class="fas fa-home"></i>
                        Overview</button>
                    <button class="dropdown-item" onclick="showSection('analytics')"><i class="fas fa-chart-line"></i>
                        Growth Analytics</button>
                    <button class="dropdown-item" onclick="showSection('achievements')"><i class="fas fa-medal"></i>
                        Achievements <span class="badge warning">8</span></button>
                </div>
            </div>

            <!-- Applications Dropdown -->
            <div class="dropdown" id="applicationsDropdown">
                <button class="dropdown-toggle" onclick="toggleDropdown('applicationsDropdown')">
                    <i class="fas fa-vault"></i> Portfolio <i class="fas fa-chevron-down"
                        style="font-size: 0.7rem;"></i>
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" onclick="showSection('applications')"><i class="fas fa-list"></i> My
                        Applications <span class="badge">12</span></button>
                    <button class="dropdown-item" onclick="showSection('programs')"><i class="fas fa-rocket"></i> Open
                        Programs</button>
                    <button class="dropdown-item" onclick="showSection('drafts')"><i class="fas fa-file-pen"></i> Drafts
                        <span class="badge warning">2</span></button>
                </div>
            </div>

            <!-- Network Dropdown -->
            <div class="dropdown" id="networkDropdown">
                <button class="dropdown-toggle" onclick="toggleDropdown('networkDropdown')">
                    <i class="fas fa-users"></i> Network <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i>
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" onclick="showSection('referrals')"><i
                            class="fas fa-handshake-angle"></i> Referrals <span class="badge success">3</span></button>
                    <button class="dropdown-item" onclick="showSection('connections')"><i
                            class="fas fa-circle-nodes"></i> Connections</button>
                    <button class="dropdown-item" onclick="showSection('messages')"><i class="fas fa-comments"></i>
                        Messages <span class="badge">5</span></button>
                </div>
            </div>


        </div>

        <div class="dropdown profile-dropdown" id="profileDropdown">
            <div class="profile-toggle dropdown-toggle" onclick="toggleDropdown('profileDropdown')">
                <div class="avatar" style="overflow: hidden;">
                    {% if current_user.profile_pic %}
                    <img src="{{ current_user.profile_pic }}" alt="Avatar"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                    {{ current_user.name[0] if current_user.name else 'S' }}
                    {% endif %}
                </div>
                <span class="profile-name">{{ current_user.name }}</span>
                <i class="fas fa-chevron-down"
                    style="color: rgba(255,255,255,0.4); font-size: 0.7rem; margin-left: 5px;"></i>
            </div>
            <div class="dropdown-menu" style="left: auto; right: 0; min-width: 200px;">
                <button class="dropdown-item" onclick="showSection('settings')"><i class="fas fa-gear"></i>
                    Settings</button>
                <a href="/" class="dropdown-item" style="text-decoration: none;"><i class="fas fa-house"></i> Back to
                    Home</a>
                <a href="/startup/profile/edit" class="dropdown-item" style="text-decoration: none;"><i
                        class="fas fa-file-pen"></i> Edit Startup Form</a>
                <button class="dropdown-item" onclick="showSettingsTab('security')"><i class="fas fa-shield-halved"></i>
                    Security</button>
                <button class="dropdown-item" onclick="showSettingsTab('notifications')"><i class="fas fa-bell"></i>
                    Notifications</button>
                <div style="border-top: 1px solid #f1f5f9; margin: 0.5rem 0;"></div>
                <a href="/logout" class="dropdown-item" style="color: #ef4444;"><i
                        class="fas fa-right-from-bracket"></i> Sign Out</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <!-- OVERVIEW SECTION -->
        <section id="overview" class="section active">
            <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: flex-end;">
                <div>
                    <h1 class="dashboard-title">Welcome back, {{ current_user.name }}!</h1>
                    <p class="dashboard-subtitle">Your venture is performing in the top 4% of this batch.</p>
                </div>
                <a href="/startup/profile/edit" class="btn btn-outline"
                    style="text-decoration: none; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-edit"></i> Edit Startup Form
                </a>
            </div>

            <div class="cards-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Market Readiness</div>
                        <div class="stat-icon yellow"><i class="fas fa-rocket"></i></div>
                    </div>
                    <div class="stat-number">{{ stats.market_readiness }}</div>
                    <div class="trend up"><i class="fas fa-arrow-up"></i> +12%</div>
                </div>
                <div class="stat-card" style="cursor: pointer;" onclick="showSection('connections')">
                    <div class="stat-header">
                        <div class="stat-label">Network Reach</div>
                        <div class="stat-icon blue"><i class="fas fa-share-nodes"></i></div>
                    </div>
                    <div class="stat-number">{{ stats.network_reach }}</div>
                    <div class="trend up"><i class="fas fa-arrow-up"></i> High</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Success Rate</div>
                        <div class="stat-icon green"><i class="fas fa-bullseye"></i></div>
                    </div>
                    <div class="stat-number">{{ stats.success_rate }}</div>
                    <div class="trend up"><i class="fas fa-check"></i> Robust</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-label">Hub Level</div>
                        <div class="stat-icon purple"><i class="fas fa-gem"></i></div>
                    </div>
                    <div class="stat-number">{{ stats.hub_level }}</div>
                    <div class="trend up"><i class="fas fa-bolt"></i> Rising Star</div>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="content-box">
                    <div class="box-header">
                        <h3 class="box-title">Growth Trajectory</h3>
                        <span style="font-size: 0.75rem; font-weight: 800; color: var(--text-dim);">LIVE METRICS</span>
                    </div>
                    <canvas id="mainGrowthChart" height="110"></canvas>
                </div>

                <div class="content-box">
                    <h3 class="box-title" style="margin-bottom: 1.5rem;">Recent Activity</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {% if milestones %}
                        {% for m in milestones %}
                        <div
                            style="display: flex; align-items: center; gap: 12px; padding-bottom: 12px; border-bottom: 1px solid #f1f5f9;">
                            <div
                                style="width: 36px; height: 36px; border-radius: 10px; background: #f1f5f9; display: flex; align-items: center; justify-content: center;">
                                <i class="{{ m.icon }}" style="font-size: 0.8rem;"></i>
                            </div>
                            <div>
                                <h4 style="font-size: 0.85rem; font-weight: 800;">{{ m.title }}</h4>
                                <p style="font-size: 0.7rem; color: var(--text-dim);">{{ m.time }}</p>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p style="color: var(--text-dim); font-size: 0.8rem;">No recent activity yet.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- APPLICATIONS SECTION -->
        <section id="applications" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">My Portfolio</h1>
                <p class="dashboard-subtitle">Managing {{ startup.name if startup else 'Your Startup' }}'s active
                    program engagements.</p>
            </div>

            <div class="content-box">
                <div class="box-header">
                    <h3 class="box-title">Active Applications</h3>
                    <button class="btn btn-black" onclick="showSection('programs')">New Application</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Program Hub</th>
                            <th>Applied Date</th>
                            <th>Current Status</th>
                            <th>Last Update</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if applications %}
                        {% for app in applications %}
                        <tr>
                            <td><strong>{{ app.title }}</strong></td>
                            <td>{{ app.created_at }}</td>
                            <td><span
                                    class="status-pill {{ 'active' if 'accepted' in app.status or 'verified' in app.status else 'pending' }}">{{
                                    app.status|title }}</span></td>
                            <td>{{ app.last_update }}</td>
                            <td><a href="/startup/applications/{{ app.id }}" class="btn btn-outline"
                                    style="padding: 6px 14px; text-decoration:none;">View Details</a></td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="5" style="text-align:center; color: var(--text-dim);">No active applications
                                found. <a href="#" onclick="showSection('programs')">Browse Programs</a></td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- PROGRAMS SECTION -->
        <section id="programs" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Open Programs</h1>
                <p class="dashboard-subtitle">Discover new opportunities and ecosystem initiatives.</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                {% if available_programs %}
                {% for program in available_programs %}
                <div class="content-box" style="display: flex; flex-direction: column; justify-content: space-between;">
                    <div>
                        <div
                            style="width: 100%; height: 160px; border-radius: 12px; overflow: hidden; margin-bottom: 1.25rem;">
                            <img src="{{ program.banner_url or '/static/img/program-card.jpg' }}"
                                alt="{{ program.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <h3 class="box-title" style="margin-bottom: 0.5rem;">{{ program.title }}</h3>
                        <p
                            style="font-size: 0.85rem; color: var(--text-dim); line-height: 1.5; margin-bottom: 1.25rem; display: -webkit-box; -webkit-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                            {{ program.description }}</p>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border); padding-top: 1rem;">
                        <span
                            style="font-size: 0.75rem; font-weight: 800; color: var(--primary-dark); text-transform: uppercase;">{{
                            program.type|replace('_', ' ') }}</span>
                        <a href="/opportunities/{{ program.id }}" class="btn btn-black"
                            style="padding: 6px 14px; text-decoration: none; font-size: 0.8rem;">Apply Now</a>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="content-box" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                    <p style="color: var(--text-dim); font-weight: 700;">No new programs available at the moment. Check
                        back later!</p>
                </div>
                {% endif %}
            </div>
        </section>

        <!-- ANALYTICS SECTION -->
        <section id="analytics" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Deep-Dive Analytics</h1>
                <p class="dashboard-subtitle">Comparative performance metrics across your industry sector.</p>
            </div>

            <div class="analytics-grid">
                <div class="content-box">
                    <h3 class="box-title" style="margin-bottom: 2rem;">Funnel Efficiency</h3>
                    <canvas id="funnelAnalyticsChart" height="150"></canvas>
                </div>
                <div class="content-box">
                    <h3 class="box-title" style="margin-bottom: 2rem;">Ecosystem Fit</h3>
                    <canvas id="radarFitChart" height="200"></canvas>
                    <div style="margin-top: 2rem; background: #f8fafc; padding: 1rem; border-radius: 14px;">
                        <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem;">AI Insight</h4>
                        <p style="font-size: 0.8rem; color: var(--text-dim); line-height: 1.5;">Your "Team Grit" score
                            is exceptional. Consider highlighting internal operational stability in your next pitch.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- REFERRALS SECTION -->
        <section id="referrals" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Ecosystem Referrals</h1>
                <p class="dashboard-subtitle">Authorized warm introductions from your enabler network.</p>
            </div>

            <div class="content-box">
                <table>
                    <thead>
                        <tr>
                            <th>Origin Enabler</th>
                            <th>Target Program</th>
                            <th>Priority</th>
                            <th>Expiry</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if referrals %}
                        {% for ref in referrals %}
                        <tr>
                            <td>
                                <div style="font-weight: 800;">{{ ref.enabler_name }}</div>
                                <div style="font-size: 0.75rem; color: var(--text-dim);">{{ ref.enabler_role }}</div>
                            </td>
                            <td><strong>{{ ref.program_name }}</strong></td>
                            <td><span class="status-pill pending"
                                    style="background: rgba(255, 223, 0, 0.2); color: #856404;">{{ ref.priority
                                    }}</span>
                            </td>
                            <td>{{ ref.status|title }}</td>
                            <td><a href="/opportunities/{{ ref.opportunity_id }}" class="btn btn-black"
                                    style="padding: 6px 14px; text-decoration: none;">View Program</a></td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="5" style="text-align:center; color: var(--text-dim);">No referrals received
                                yet.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ACHIEVEMENTS SECTION -->
        <section id="achievements" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Achievements & Recognition</h1>
                <p class="dashboard-subtitle">Milestones that validate your startup's excellence.</p>
            </div>

            <div class="content-box">
                <div class="badges-container">
                    <div class="badge-card earned">
                        <i class="fas fa-rocket"></i>
                        <h4>Early Mover</h4>
                        <p>First application filed</p>
                    </div>
                    <div class="badge-card earned">
                        <i class="fas fa-bolt"></i>
                        <h4>Speed Demon</h4>
                        <p>Fast track verified</p>
                    </div>
                    <div class="badge-card earned">
                        <i class="fas fa-handshake"></i>
                        <h4>Enabler Approved</h4>
                        <p>First warm referral</p>
                    </div>
                    <div class="badge-card">
                        <i class="fas fa-star"></i>
                        <h4>Ecosystem Leader</h4>
                        <p>Locked: Reach Lvl 10</p>
                    </div>
                    <div class="badge-card">
                        <i class="fas fa-coins"></i>
                        <h4>Funded Master</h4>
                        <p>Locked: Series A Prep</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CONNECTIONS SECTION -->
        <section id="connections" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Network Connections</h1>
                <p class="dashboard-subtitle">Your inner circle of investors, mentors, and corporate partners.</p>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                <div class="content-box">
                    <h3 class="box-title" style="margin-bottom: 1.5rem;">Suggested for You</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {% if suggested_connections %}
                        {% for user in suggested_connections %}
                        <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: #f8fafc; border-radius: 12px; transition: var(--transition); border: 1px solid transparent;"
                            onmouseover="this.style.borderColor='var(--primary)'"
                            onmouseout="this.style.borderColor='transparent'">
                            <div class="avatar" {% if loop.index is odd
                                %}style="background: var(--primary); color: #000; font-weight: 800; font-size: 0.8rem; overflow: hidden;"
                                {% else
                                %}style="background: #3b82f6; color: #fff; font-weight: 800; font-size: 0.8rem; overflow: hidden;"
                                {% endif %}>
                                {% if user.profile_pic %}
                                <img src="{{ user.profile_pic }}" alt="{{ user.name }}"
                                    style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                {{ user.name[0]|upper }}
                                {% endif %}
                            </div>
                            <div style="flex: 1;">
                                <h4 style="font-size: 0.9rem; font-weight: 800; margin-bottom: 2px;">{{ user.name }}
                                </h4>
                                <p style="font-size: 0.75rem; color: var(--text-dim);">{{ user.company or
                                    user.role|title }}</p>
                            </div>
                            <button class="btn btn-black connect-btn" style="padding: 6px 12px; font-size: 0.75rem;"
                                data-name="{{ user.name }}">Connect</button>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p style="text-align: center; color: var(--text-dim); padding: 1rem;">No suggestions available
                            right now.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="content-box">
                    <h3 class="box-title" style="margin-bottom: 1.5rem;">Your Network</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem; opacity: 0.6;">
                        <div style="text-align: center; padding: 2rem;">
                            <i class="fas fa-link-slash"
                                style="font-size: 2rem; color: var(--text-dim); margin-bottom: 1rem;"></i>
                            <p style="font-size: 0.85rem; color: var(--text-dim);">You haven't made any direct
                                connections yet. Start connecting with suggested experts!</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- MESSAGES SECTION -->
        <section id="messages" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Inbox</h1>
                <p class="dashboard-subtitle">Secure communication with the Alchemy ecosystem.</p>
            </div>
            <div class="content-box" style="padding: 0; overflow: hidden;">
                <div style="display: grid; grid-template-columns: 350px 1fr; height: 500px;">
                    <div style="border-right: 1px solid var(--border); overflow-y: auto;">
                        <div
                            style="padding: 1rem; border-bottom: 1px solid var(--border); background: #f8fafc; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-search" style="color: var(--text-dim);"></i>
                            <input type="text" placeholder="Search chats..."
                                style="border:none; background:none; outline:none; font-size: 0.85rem; width: 100%;">
                        </div>
                        <div
                            style="padding: 1.25rem; background: rgba(255, 223, 0, 0.05); border-left: 4px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-weight: 800; font-size: 0.9rem;">Sarah Chen</span>
                                <span style="font-size: 0.7rem; color: var(--text-dim);">10:45 AM</span>
                            </div>
                            <p
                                style="font-size: 0.8rem; color: #000; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                I've shared your deck with the NYC hub...</p>
                        </div>
                    </div>
                    <div
                        style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #f8fafc; color: var(--text-dim);">
                        <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.2;"></i>
                        <p style="font-weight: 700;">Select a thread to start chatting</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- DOCUMENTS SECTION -->
        <section id="documents" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Startup Vault</h1>
                <p class="dashboard-subtitle">Manage your pitch decks, financial models, and legal documents.</p>
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                {% if startup.pitch_deck_url %}
                <div class="content-box" style="text-align: center;">
                    <i class="fas fa-file-pdf" style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;"></i>
                    <h4 style="font-weight: 800; margin-bottom: 0.25rem;">Pitch Deck</h4>
                    <p style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 1.5rem;">Updated: {{
                        startup.updated_at.strftime('%b %d, %Y') if startup.updated_at else 'Recently' }}</p>
                    <a href="{{ startup.pitch_deck_url }}" target="_blank" class="btn btn-outline"
                        style="width: 100%; text-decoration: none; display: block;"><i class="fas fa-download"></i> View
                        Deck</a>
                </div>
                {% endif %}

                {% if startup.logo_url %}
                <div class="content-box" style="text-align: center;">
                    <i class="fas fa-image" style="font-size: 3rem; color: #3b82f6; margin-bottom: 1rem;"></i>
                    <h4 style="font-weight: 800; margin-bottom: 0.25rem;">Company Logo</h4>
                    <p style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 1.5rem;">Official Branding</p>
                    <a href="{{ startup.logo_url }}" target="_blank" class="btn btn-outline"
                        style="width: 100%; text-decoration: none; display: block;"><i class="fas fa-download"></i> View
                        Logo</a>
                </div>
                {% endif %}

                <div class="content-box"
                    style="text-align: center; border: 2px dashed var(--border); background: transparent; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;"
                    onclick="showSection('settings')">
                    <i class="fas fa-plus-circle"
                        style="font-size: 2.5rem; color: var(--text-dim); margin-bottom: 1rem;"></i>
                    <h4 style="font-weight: 800; margin-bottom: 0.25rem; color: var(--text-dim);">Add Document</h4>
                    <p style="font-size: 0.75rem; color: var(--text-dim);">Update via profile edit</p>
                </div>
            </div>
        </section>

        <!-- TEMPLATES SECTION -->
        <section id="templates" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Pitch Templates</h1>
                <p class="dashboard-subtitle">Professional frameworks to help you secure your next round.</p>
            </div>
            <div class="content-box">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div style="padding: 1.5rem; border: 1px solid var(--border); border-radius: 16px;">
                        <h4 style="font-size: 1.1rem; font-weight: 800; margin-bottom: 0.5rem;">Series A Deck</h4>
                        <p style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 1.5rem;">Used by 45+
                            Graduates.</p>
                        <button class="btn btn-black">Use Template</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- GUIDES SECTION -->
        <section id="guides" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Growth Guides</h1>
                <p class="dashboard-subtitle">Expert resources curated for the early-stage founder.</p>
            </div>
            <div class="content-box" style="display: flex; align-items: center; gap: 20px;">
                <div style="font-size: 2rem;">ðŸ“š</div>
                <div style="flex: 1;">
                    <h4 style="font-size: 1rem; font-weight: 800;">Mastering B2B Sales Cycles</h4>
                    <p style="font-size: 0.8rem; color: var(--text-dim);">Close corporate deals faster.</p>
                </div>
                <button class="btn btn-outline">Read Guide</button>
            </div>
        </section>

        <!-- PROFILE SETTINGS SECTION -->
        <section id="settings" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Account Settings</h1>
                <p class="dashboard-subtitle">Manage your personal profile, security, and notification preferences.</p>
            </div>

            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
                <!-- Internal Nav -->
                <div class="content-box" style="padding: 1rem; height: fit-content;">
                    <button class="dropdown-item active settings-nav" id="nav-personal"
                        onclick="showSettingsTab('personal')"><i class="fas fa-user"></i> Personal Info</button>
                    <button class="dropdown-item settings-nav" id="nav-security"
                        onclick="showSettingsTab('security')"><i class="fas fa-shield-alt"></i> Security</button>
                    <button class="dropdown-item settings-nav" id="nav-notifications"
                        onclick="showSettingsTab('notifications')"><i class="fas fa-bell"></i> Notifications</button>
                </div>

                <div class="content-box">
                    <form action="/startup/settings/update" method="POST" enctype="multipart/form-data"
                        id="settingsForm">
                        <!-- Personal Info Tab -->
                        <div id="settings-personal" class="settings-tab active">
                            <h3 class="box-title" style="margin-bottom: 2rem;">Personal Information</h3>

                            <!-- Profile Picture Section -->
                            <div
                                style="display: flex; align-items: center; gap: 2rem; margin-bottom: 2.5rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                                <div style="position: relative;">
                                    <div
                                        style="width: 100px; height: 100px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; color: #000; overflow: hidden; border: 4px solid var(--border);">
                                        {% if current_user.profile_pic %}
                                        <img src="{{ current_user.profile_pic }}" alt="Profile"
                                            style="width: 100%; height: 100%; object-fit: cover;">
                                        {% else %}
                                        {{ current_user.name[0] if current_user.name else 'S' }}
                                        {% endif %}
                                    </div>
                                    <input type="file" name="profile_pic" id="profile_pic_input" style="display: none;"
                                        accept="image/*" onchange="previewImage(this)">
                                    <button type="button" onclick="document.getElementById('profile_pic_input').click()"
                                        style="position: absolute; bottom: 0; right: 0; width: 32px; height: 32px; border-radius: 50%; background: #000; color: var(--primary); border: 2px solid #fff; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                        <i class="fas fa-camera" style="font-size: 0.8rem;"></i>
                                    </button>
                                </div>
                                <div>
                                    <h4 style="font-size: 1.1rem; font-weight: 800; margin-bottom: 0.5rem;">Profile
                                        Picture
                                    </h4>
                                    <p style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 1rem;">
                                        {% if current_user.google_id %}
                                        <i class="fab fa-google"></i> Synced with your Google Account.
                                        {% else %}
                                        PNG, JPG or GIF. Max 2MB.
                                        {% endif %}
                                    </p>
                                    <div style="display: flex; gap: 0.75rem; align-items: center;">
                                        <button type="button" class="btn btn-black"
                                            style="padding: 8px 16px; font-size: 0.85rem;"
                                            onclick="document.getElementById('profile_pic_input').click()">Upload
                                            New</button>

                                        {% if current_user.profile_pic %}
                                        <button type="button" class="btn btn-outline"
                                            style="padding: 8px 16px; font-size: 0.85rem; color: #ef4444; border-color: #ef4444;"
                                            onclick="if(confirm('Are you sure you want to remove your profile photo?')) document.getElementById('removePhotoForm').submit();">
                                            Remove Photo
                                        </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                                <div>
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">Full
                                        Name</label>
                                    <input type="text" name="full_name" value="{{ current_user.name }}"
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; font-weight: 600;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">Email
                                        Address</label>
                                    <input type="email" name="email" value="{{ current_user.email }}" readonly
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: #f8fafc; color: var(--text-dim);">
                                </div>
                                <div>
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">Phone
                                        Number</label>
                                    <input type="text" name="phone" value="+1 (555) 000-0000"
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; font-weight: 600;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">Location</label>
                                    <input type="text" name="location"
                                        value="{{ current_user.region or 'San Francisco, CA' }}"
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; font-weight: 600;">
                                </div>
                            </div>
                        </div>

                        <!-- Security Tab -->
                        <div id="settings-security" class="settings-tab">
                            <h3 class="box-title" style="margin-bottom: 1.5rem;">Security & Password</h3>
                            <div style="max-width: 400px;">
                                <div style="margin-bottom: 1.5rem;">
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">Current
                                        Password</label>
                                    <input type="password" name="current_password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px;">
                                </div>
                                <div style="margin-bottom: 1.5rem;">
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">New
                                        Password</label>
                                    <input type="password" name="new_password" placeholder="Min 8 characters"
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px;">
                                </div>
                                <div style="margin-bottom: 1.5rem;">
                                    <label
                                        style="display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.5rem;">Confirm
                                        New Password</label>
                                    <input type="password" name="confirm_password" placeholder="Confirm"
                                        style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px;">
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Tab -->
                        <div id="settings-notifications" class="settings-tab">
                            <h3 class="box-title" style="margin-bottom: 1.5rem;">Notification Preferences</h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div
                                    style="display: flex; align-items: center; justify-content: space-between; padding: 1.25rem; background: #f8fafc; border-radius: 16px;">
                                    <div>
                                        <h4 style="font-size: 0.95rem; font-weight: 800;">Email Updates</h4>
                                        <p style="font-size: 0.8rem; color: var(--text-dim);">Weekly reports and
                                            application
                                            status.</p>
                                    </div>
                                    <div class="toggle-btn active" onclick="toggleSwitch(this)">
                                        <div class="toggle-dot"></div>
                                    </div>
                                </div>
                                <div
                                    style="display: flex; align-items: center; justify-content: space-between; padding: 1.25rem; background: #f8fafc; border-radius: 16px;">
                                    <div>
                                        <h4 style="font-size: 0.95rem; font-weight: 800;">SMS Notifications</h4>
                                        <p style="font-size: 0.8rem; color: var(--text-dim);">Real-time alerts for
                                            mentor
                                            messages.</p>
                                    </div>
                                    <div class="toggle-btn" onclick="toggleSwitch(this)">
                                        <div class="toggle-dot"></div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Common Footer -->
                        <div
                            style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #f1f5f9; display: flex; gap: 1rem; align-items: center;">
                            <button type="submit" class="btn btn-black" id="saveBtn">Save Changes</button>
                            <button type="button" class="btn btn-outline"
                                onclick="showSection('overview')">Cancel</button>
                            <div id="saveStatus"
                                style="font-size: 0.85rem; font-weight: 800; color: #10b981; display: none; align-items: center; gap: 5px;">
                                <i class="fas fa-check-circle"></i> Saved!
                            </div>
                        </div>
                    </form>

                    <!-- Hidden Form for Profile Photo Removal -->
                    <form id="removePhotoForm" action="/startup/settings/remove_photo" method="POST"
                        style="display: none;">
                    </form>
                </div>
            </div>
        </section>

        <!-- DRAFTS SECTION -->
        <section id="drafts" class="section">
            <div class="dashboard-header">
                <h1 class="dashboard-title">My Drafts</h1>
                <p class="dashboard-subtitle">Incomplete applications waiting for your final touch.</p>
            </div>
            <div class="content-box" style="text-align: center; padding: 3rem;">
                <p style="color: var(--text-dim); font-weight: 700;">No active drafts found</p>
            </div>
        </section>

    </main>

    <script>
        let growthChart, funnelChart, radarChart;

        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const isActive = dropdown.classList.contains('active');

            // Close all
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));

            // Toggle current if it wasn't active
            if (!isActive) {
                dropdown.classList.add('active');
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(sectionId);
            if (target) {
                target.classList.add('active');
            }

            // Update nav active state
            document.querySelectorAll('.dropdown-toggle').forEach(btn => btn.classList.remove('active'));

            // Map section to dropdown
            const mapping = {
                'overview': 'dashboardDropdown',
                'analytics': 'dashboardDropdown',
                'achievements': 'dashboardDropdown',
                'applications': 'applicationsDropdown',
                'programs': 'applicationsDropdown',
                'drafts': 'applicationsDropdown',
                'referrals': 'networkDropdown',
                'connections': 'networkDropdown',
                'messages': 'networkDropdown',
                'settings': 'profileDropdown'
            };

            const dropdownId = mapping[sectionId];
            if (dropdownId) {
                document.getElementById(dropdownId).querySelector('.dropdown-toggle').classList.add('active');
            }

            // Re-init charts if section is analytics or overview
            if (sectionId === 'overview' || sectionId === 'analytics') {
                initCharts();
            }

            // Close dropdowns
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
        }

        function getChartColors() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            return {
                grid: isDark ? 'rgba(255,255,255,0.1)' : '#f1f5f9',
                text: isDark ? '#94a3b8' : '#64748b',
                main: '#ffdf00'
            };
        }

        async function initCharts() {
            const colors = getChartColors();

            try {
                const response = await fetch('/api/startups/analytics');
                const result = await response.json();

                if (!result.success) return;

                const { funnel, growth, radar } = result;

                // Growth Chart
                const ctxGrowth = document.getElementById('mainGrowthChart');
                if (ctxGrowth) {
                    if (growthChart) growthChart.destroy();
                    growthChart = new Chart(ctxGrowth, {
                        type: 'line',
                        data: {
                            labels: growth.labels,
                            datasets: [{
                                label: 'Growth Score',
                                data: growth.data,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 4,
                                pointRadius: 0
                            }]
                        },
                        options: {
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { grid: { display: false }, ticks: { color: colors.text } },
                                y: { display: false }
                            }
                        }
                    });
                }

                // Funnel Chart
                const ctxFunnel = document.getElementById('funnelAnalyticsChart');
                if (ctxFunnel) {
                    if (funnelChart) funnelChart.destroy();
                    funnelChart = new Chart(ctxFunnel, {
                        type: 'bar',
                        data: {
                            labels: funnel.labels,
                            datasets: [{
                                data: funnel.data,
                                backgroundColor: ['#f1f5f9', '#e2e8f0', '#cbd5e1', colors.main, '#000'],
                                borderRadius: 10
                            }]
                        },
                        options: {
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { grid: { display: false }, ticks: { color: colors.text } },
                                y: { grid: { color: colors.grid }, ticks: { color: colors.text } }
                            }
                        }
                    });
                }

                // Radar Chart
                const ctxRadar = document.getElementById('radarFitChart');
                if (ctxRadar) {
                    if (radarChart) radarChart.destroy();
                    radarChart = new Chart(ctxRadar, {
                        type: 'radar',
                        data: {
                            labels: radar.labels,
                            datasets: [{
                                label: 'You',
                                data: radar.values,
                                borderColor: colors.main,
                                backgroundColor: 'rgba(255, 223, 0, 0.2)',
                                borderWidth: 3
                            }, {
                                label: 'Batch Avg',
                                data: [70, 75, 70, 80, 75],
                                borderColor: '#94a3b8',
                                backgroundColor: 'rgba(148, 163, 184, 0.1)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            plugins: { legend: { position: 'bottom', labels: { color: colors.text } } },
                            scales: {
                                r: {
                                    grid: { color: colors.grid },
                                    angleLines: { color: colors.grid },
                                    pointLabels: { font: { weight: '800' }, color: colors.text }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error fetching analytics:', error);
            }
        }

        // Close dropdowns on click outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown') && !e.target.closest('.profile-dropdown')) {
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            }
        });

        // Settings Functions
        function showSettingsTab(tabId) {
            // First ensure settings section is visible
            showSection('settings');

            // Update internal nav active state
            document.querySelectorAll('.settings-nav').forEach(btn => btn.classList.remove('active'));
            const specificNav = document.getElementById('nav-' + tabId);
            if (specificNav) specificNav.classList.add('active');

            // Switch tabs
            document.querySelectorAll('.settings-tab').forEach(tab => tab.classList.remove('active'));
            const targetTab = document.getElementById('settings-' + tabId);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        function setTheme(mode, el) {
            document.querySelectorAll('.theme-card').forEach(c => {
                c.classList.remove('active');
                c.style.borderColor = 'var(--border)';
            });
            if (el) {
                el.classList.add('active');
                el.style.borderColor = 'var(--primary)';
            }

            document.documentElement.setAttribute('data-theme', mode === 'dark' ? 'dark' : 'light');
            localStorage.setItem('innoTheme', mode);

            // Re-init charts to update colors for dark mode
            setTimeout(initCharts, 100);
        }

        function toggleSwitch(el) {
            el.classList.toggle('active');
        }

        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = input.parentElement.querySelector('img');
                    if (img) {
                        img.src = e.target.result;
                    } else {
                        // If there was no image (just initials), replace the div content
                        const container = input.parentElement.querySelector('div');
                        container.innerHTML = `<img src="${e.target.result}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;">`;
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function simulateConnect(btn, name) {
            console.log('Connecting to:', name);

            // Visual feedback
            const originalText = btn.innerText;
            btn.innerText = 'Request Sent';
            btn.classList.remove('btn-black');
            btn.classList.add('btn-outline');
            btn.disabled = true;

            // Fallback name
            const displayName = name || 'User';

            // Show toast
            const toast = document.createElement('div');
            toast.className = 'dashboard-toast';
            toast.style.cssText = `
                position: fixed; bottom: 30px; right: 30px; 
                background: #000; color: #fff; padding: 12px 24px; 
                border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                z-index: 9999; animation: slideIn 0.3s ease;
                display: flex; align-items: center; gap: 10px; font-weight: 700;
            `;
            toast.innerHTML = `<i class="fas fa-check-circle" style="color: var(--primary);"></i> Connection request sent to ${displayName}`;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Add keyframes for toast
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
            @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        `;
        document.head.appendChild(style);

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('innoTheme') || 'light';
            setTheme(savedTheme, document.querySelector(`.theme-card[onclick*="'${savedTheme}'"]`));

            initCharts();
            console.log("Alchemy Dashboard Initialized with Mock Data");

            // Connect button listener
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.connect-btn');
                if (btn && !btn.disabled) {
                    simulateConnect(btn, btn.getAttribute('data-name'));
                }
            });
        });
    </script>
</body>

</html>